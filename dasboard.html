<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard – Budget Tracker</title>

    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: #E8DCC4;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .section {
            background: #F5F1E8;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(62, 39, 35, 0.1);
        }

        h1, h2 {
            color: #3E2723;
            margin-bottom: 20px;
            font-weight: 400;
            letter-spacing: 1px;
        }

        .budget-bar-container {
            margin-bottom: 40px;
            background: #F5F1E8;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(62, 39, 35, 0.1);
        }

        .progress-bar-wrapper {
            position: relative;
            height: 50px;
            background: #D7CCC8;
            border-radius: 25px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #6D4C41 0%, #5D4037 50%, #4E342E 100%);
            transition: width 0.5s ease;
        }

        canvas {
            margin-top: 20px;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div style="max-width:1000px;margin:0 auto 10px auto;">
    <a href="index.html" style="
        text-decoration:none;
        color:#3E2723;
        font-size:13px;
        background:#F5F1E8;
        padding:6px 14px;
        border-radius:20px;
        box-shadow:0 2px 6px rgba(62,39,35,0.12);
        display:inline-block;
    ">← Home</a>
</div>

<div class="container">

    <h1>DASHBOARD</h1>

    <!-- BUDGET OVERVIEW -->
    <div class="budget-bar-container">
        <h2>Budget Overview</h2>
        <div class="progress-bar-wrapper">
            <div class="progress-bar-fill" id="dashboard-progress"></div>
        </div>
        <p id="dashboard-summary"></p>
    </div>

    <!-- PIE CHART -->
    <div class="section">
        <h2>Spending by Category</h2>
        <div style="max-width:420px;margin:0 auto;">
            <canvas id="pieChart"></canvas>
        </div>
    </div>

    <!-- BAR CHART -->
    <div class="section">
        <h2>Actual Spending (by Category)</h2>
        <canvas id="barChart"></canvas>
    </div>

    <!-- LINE GRAPH -->
    <div class="section">
        <h2>Spending Over Time (Last 12 Months)</h2>
        <canvas id="lineChart"></canvas>
    </div>

</div>

<script>
/* ===== READ REAL USER DATA ===== */

const income = parseFloat(localStorage.getItem("income")) || 0;
const expenses = JSON.parse(localStorage.getItem("expenses")) || [];

/* ===== TOTALS ===== */

const totalExpenses = expenses.reduce((sum, e) => sum + e.monthlyAmount, 0);
const remaining = income - totalExpenses;
const percentUsed = income > 0 ? (totalExpenses / income) * 100 : 0;

/* ===== UPDATE BUDGET BAR ===== */

document.getElementById("dashboard-progress").style.width =
    Math.min(percentUsed, 100) + "%";

document.getElementById("dashboard-summary").textContent =
    `Income: $${income.toFixed(0)} • Spent: $${totalExpenses.toFixed(0)} • Remaining: $${remaining.toFixed(0)}`;

/* ===== CATEGORY TOTALS ===== */

const categoryTotals = {};
expenses.forEach(e => {
    categoryTotals[e.name] = (categoryTotals[e.name] || 0) + e.monthlyAmount;
});

/* ===== PIE CHART (TEMP RANDOM DEMO DATA) ===== */

new Chart(document.getElementById("pieChart"), {
    type: 'pie',
    data: {
        labels: [
            'Rent',
            'Groceries',
            'Entertainment',
            'Transportation',
            'Utilities',
            'Other'
        ],
        datasets: [{
            data: [650, 400, 250, 150, 200, 100], // demo numbers
            backgroundColor: [
                '#EFE6D6',
                '#DDCDB5',
                '#D7CCC8',
                '#A1887F',
                '#6D4C41',
                '#3E2723'
            ]
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true
    }
});

/* ===== BAR CHART ===== */

new Chart(document.getElementById("barChart"), {
    type: 'bar',
    data: {
        labels: Object.keys(categoryTotals),
        datasets: [{
            label: 'Actual Spending',
            data: Object.values(categoryTotals),
            backgroundColor: '#6D4C41'
        }]
    },
    options: {
        scales: {
            y: { beginAtZero: true }
        }
    }
});

/* ===== LINE GRAPH: LAST 12 MONTHS ===== */

const monthlyTotals = {};

expenses.forEach(e => {
    const d = new Date(e.date);
    const key = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
    monthlyTotals[key] = (monthlyTotals[key] || 0) + e.monthlyAmount;
});

const labels = [];
const values = [];
const now = new Date();

for (let i = 11; i >= 0; i--) {
    const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
    const key = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;

    labels.push(
        d.toLocaleString('default', { month:'short', year:'numeric' })
    );
    values.push(monthlyTotals[key] || 0);
}

new Chart(document.getElementById("lineChart"), {
    type: 'line',
    data: {
        labels,
        datasets: [{
            label: 'Total Spent',
            data: values,
            borderColor: '#6D4C41',
            backgroundColor: 'rgba(109,76,65,0.15)',
            tension: 0.35,
            fill: true,
            pointRadius: 5,
            pointBackgroundColor: '#3E2723'
        }]
    },
    options: {
        scales: {
            y: { beginAtZero: true }
        }
    }
});
</script>

</body>
</html>